// Search Autocomplete routines.
// updated: 2009.04.02
// English

var search_box_default = "Enter keyword(s)";
var search_box_prompt = "You must enter a keyword before clicking on Search button.";

jQuery.noConflict();

function set_css() {
	jQuery(".jqac-menu").css({
		'color': '#333333',
		'background-color': 'white',
		'border': '1px solid #aaa',
		'font-family': 'Verdana, Geneva, Arial, Helvetica, sans-serif',
		'font-size': '8pt'
		});
	jQuery(".jqac-menu ul").css({
		'list-style':'none',
		'margin':'1px',
		'padding':'1px',
		'overflow':'hidden',
		'background-color': 'white'
		});
	jQuery(".jqac-menu em").css({'text-decoration':'none'});
	jQuery(".jqac-menu .jqac-match").css({'text-decoration':'none'});
	jQuery(".jqac-menu .jqac-link").css({'cursor':'hand',
		'cursor':'pointer',
		'display':'block',
		'overflow':'hidden'
		});
}
 
function get_suggest(v,cont){
				 
	var acPath = "/search/complete";
	// check if searchHost was declared by search-loader.js
	// and if it is, prepend it to the path
	if(typeof(searchHost)!="undefined") {
		acPath = searchHost + acPath;
	}
	
	jQuery.get(acPath,{q:v},
		function(obj){
			var res = [];
			for(var i=0;i<obj.length;i++){
				res.push({ id:i , value:obj[i]});
			}
			cont(res);
			set_css();
        },
        'json');
}
        
function setOptionFastSearch(ac_obj){ 
	if(typeof(document.SiteSearchForm.questionbox)!="undefined") {
		if(ac_obj) {
			document.SiteSearchForm.questionbox.value=ac_obj.value;
			document.SiteSearchForm.submit();
		}
	}
}

function setOptionInquira(ac_obj){ 
	if(typeof(document.SiteSearchForm.question_box)!="undefined") {
		if(ac_obj) {
			document.SiteSearchForm.question_box.value=ac_obj.value;
			document.SiteSearchForm.submit();
		}
	}
}

jQuery(document).ready(function(){
	
	if(typeof(document.SiteSearchForm)!="undefined" && typeof(document.SiteSearchForm.searchSourceTitle)!="undefined") {
		var seachPageTitle = jQuery("title").text();
		document.SiteSearchForm.searchSourceTitle.value = seachPageTitle;
	}



	// FastSearch logic
	if(typeof(document.SiteSearchForm)!="undefined" 
	&& typeof(document.SiteSearchForm.questionbox)!="undefined") {
		if (typeof(autoCompleteEnabled)=='boolean' 
			&& autoCompleteEnabled ) {
			jQuery("#questionbox").autocomplete({ ajax_get:get_suggest, callback:setOptionFastSearch, cache:false, delay:100, minchars:3, height:140, noresults:''});
		}
		jQuery("#questionbox").click(function(){
			if ( document.SiteSearchForm.questionbox.value == search_box_default ) {
				document.SiteSearchForm.questionbox.value="";
			}
		});
		
		jQuery("#search_button").click(
			function() {
				if (( document.SiteSearchForm.questionbox.value == search_box_default )||
				    (!document.SiteSearchForm.questionbox.value)){
//					alert(search_box_prompt);
					document.SiteSearchForm.questionbox.value="";
					document.SiteSearchForm.questionbox.focus();
					return true;
				}
			}
		);
	}

	// Inquira logic (old search form)
	if(typeof(document.SiteSearchForm)!="undefined" 
	&& typeof(document.SiteSearchForm.question_box)!="undefined") {
		if (typeof(autoCompleteEnabled)=='boolean' 
			&& autoCompleteEnabled ) {
			jQuery("#question_box").autocomplete({ ajax_get:get_suggest, callback:setOptionInquira, cache:false, delay:100, minchars:3, height:300, noresults:''});
		}
		jQuery("#question_box").click(function(){
			if ( document.SiteSearchForm.question_box.value == search_box_default ) {
				document.SiteSearchForm.question_box.value="";
			}
		});
	}
	
	// Only prompt when questionbox is empty
	if ( document.SiteSearchForm && 
		 document.SiteSearchForm.questionbox &&
		 !document.SiteSearchForm.questionbox.value 
		 ) {
		document.SiteSearchForm.questionbox.value = search_box_default;
	}

});